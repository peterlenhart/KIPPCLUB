<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Fairy KIPP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --brand-blue: rgb(0, 101, 171);      /* 0/101/171 */
      --brand-violet: rgb(170, 0, 120);    /* 170/0/120 */
      --brand-green: rgb(59, 165, 43);     /* 59/165/43 */
      --brand-orange: rgb(242, 150, 0);    /* 242/150/0 */
      --card-lindgreen: rgb(191, 212, 188);/* 191/212/188 */
      --bg-dark: #111418;
      --bg-darker: #0b0e11;
      --text-light: #f7f7f7;
      --text-muted: #c4c8cc;
      --border-soft: #2a323a;
      --shadow-soft: 0 12px 24px rgba(0,0,0,0.35);
      --radius-lg: 18px;
      --radius-xl: 26px;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #1b2330 0, var(--bg-dark) 55%);
      color: var(--text-light);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .app {
      width: 100%;
      max-width: 420px;
      background: var(--bg-darker);
      border-radius: 30px;
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 22px;
      border: 1px solid #232a33;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    /* Header */

    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      padding-top: 4px;
    }

    .title {
      font-size: 26px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      display: flex;
      gap: 6px;
      align-items: baseline;
    }

    .title-fairy {
      font-family: "Segoe Script", "Comic Sans MS", system-ui, cursive;
      font-size: 24px;
      text-transform: none;
      letter-spacing: 0.02em;
      color: var(--brand-orange);
      text-shadow: 0 0 8px rgba(242,150,0,0.55);
    }

    .title-kipp {
      font-weight: 800;
      color: var(--brand-blue);
      text-shadow: 0 0 10px rgba(0,101,171,0.6);
    }

    .notch {
      position: absolute;
      top: -10px;
      width: 68px;
      height: 22px;
      background: var(--bg-darker);
      border-radius: 0 0 20px 20px;
      border: 1px solid #232a33;
      border-top: none;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.6);
    }
    .notch-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff, #888);
      opacity: 0.6;
    }

    /* Fairy button */

    .fairy-button-wrap {
      display: flex;
      justify-content: center;
      margin-top: 4px;
    }

    .fairy-button {
      position: relative;
      border: none;
      padding: 18px 30px;
      border-radius: 999px;
      background: var(--brand-orange);
      color: #1b1404;
      font-weight: 800;
      font-size: 20px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      box-shadow: 0 0 16px rgba(242,150,0,0.75);
      transition: transform 0.07s ease, box-shadow 0.07s ease;
    }

    .fairy-button::before {
      content: "";
      position: absolute;
      inset: -6px;
      border-radius: 999px;
      border: 2px dashed rgba(255, 255, 255, 0.4);
      opacity: 0.7;
    }

    .fairy-button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 0 8px rgba(242,150,0,0.6);
    }

    .fairy-button.disabled {
      opacity: 0.3;
      box-shadow: none;
      cursor: default;
    }

    /* Story card */

    .story-card {
      margin-top: 6px;
      background: #171e23;
      border-radius: var(--radius-lg);
      padding: 12px 14px 14px;
      border: 1px solid var(--border-soft);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .story-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
    }

    .story-label-row span.right {
      font-size: 10px;
    }

    .story-text-box {
      margin-top: 4px;
      background: rgba(191, 212, 188, 0.07);
      border-radius: 12px;
      padding: 10px 11px;
      min-height: 78px;
      border: 1px solid rgba(191, 212, 188, 0.35);
      font-size: 14px;
      line-height: 1.4;
      color: #e8ede7;
    }

    .story-placeholder {
      color: var(--text-muted);
      font-size: 13px;
    }

    .highlight-color {
      font-weight: 700;
      color: var(--brand-orange);
    }

    .story-controls {
      margin-top: 8px;
      display: flex;
      justify-content: flex-end;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform 0.06s ease, box-shadow 0.06s ease, opacity 0.06s ease;
      box-shadow: 0 6px 14px rgba(0,0,0,0.45);
      background: #2a323a;
      color: var(--text-light);
    }

    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 3px 8px rgba(0,0,0,0.6);
    }

    .btn-secondary {
      background: #242b32;
      box-shadow: 0 4px 10px rgba(0,0,0,0.45);
    }

    .btn-blue {
      background: var(--brand-blue);
    }

    .btn-green {
      background: var(--brand-green);
    }

    .btn-small {
      padding: 6px 13px;
      font-size: 11px;
    }

    .btn.disabled {
      opacity: 0.28;
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    /* Bottom buttons */

    .bottom-buttons {
      display: flex;
      gap: 10px;
      margin-top: 4px;
    }

    .bottom-buttons .btn {
      flex: 1;
      padding: 12px 10px;
      font-size: 13px;
      text-align: center;
    }

    /* Score */

    .score-panel {
      margin-top: 6px;
      background: #161c23;
      border-radius: var(--radius-lg);
      padding: 10px 12px;
      border: 1px solid #232a33;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: var(--text-muted);
    }

    .score-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .score-points {
      font-size: 22px;
      font-weight: 800;
      color: #ffffff;
    }

    .score-fairies {
      font-size: 12px;
    }

    .fairy-end {
      font-size: 18px;
      font-weight: 800;
      color: var(--brand-violet);
      text-align: right;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    @media (max-width: 360px) {
      .title { font-size: 22px; }
      .title-fairy { font-size: 20px; }
      .fairy-button { padding: 14px 22px; font-size: 18px; }
      .bottom-buttons .btn { font-size: 12px; padding: 10px 8px; }
    }
  </style>
</head>
<body>
  <main class="app">
    <div class="header">
      <div class="notch"><div class="notch-dot"></div></div>
      <div class="title">
        <span class="title-fairy">Fairy</span>
        <span class="title-kipp">KIPP</span>
      </div>
    </div>

    <div class="fairy-button-wrap">
      <button id="fairyButton" class="fairy-button">
        FAIRY
      </button>
    </div>

    <section class="story-card">
      <div class="story-label-row">
        <span>Fairy-Geschichte</span>
        <span class="right" id="storyStatus">noch keine Fairy</span>
      </div>
      <div id="storyBox" class="story-text-box">
        <div class="story-placeholder">
          Tippe auf <span class="highlight-color">FAIRY</span>, um eine neue
          Fairy-Geschichte zu erhalten. Dann lies sie vor – Abschnitt für
          Abschnitt – und lass danach gekippt werden.
        </div>
      </div>
      <div class="story-controls">
        <button id="nextPartButton" class="btn btn-secondary btn-small disabled">
          Weiter
        </button>
      </div>
    </section>

    <section class="bottom-buttons">
      <button id="fairyKippButton" class="btn btn-blue">
        FAIRY KIPP
      </button>
      <button id="ohneKippButton" class="btn btn-green">
        OHNE KIPP
      </button>
    </section>

    <section class="score-panel">
      <div class="score-main">
        <div>Fairy-Punkte</div>
        <div id="scorePoints" class="score-points">0</div>
        <div id="scoreFairies" class="score-fairies">
          Erzählte Fairies: 0 / 6
        </div>
      </div>
      <div id="fairyEndLabel" class="fairy-end"></div>
    </section>
  </main>

  <script>
    // -----------------------------
    // Daten für Motive & Farben
    // -----------------------------
    const motifs = [
      {
        key: "wasserball",
        name: "Wasserball",
        articleAcc: "einen",
        hints: [
          "Etwas Rundes hüpfte im Schatten zwischen Sand und Gras, als würde es jede Berührung freudig zurückfedern."
        ]
      },
      {
        key: "auto",
        name: "Auto",
        articleAcc: "ein",
        hints: [
          "Zwischen zwei moosigen Felsblöcken glänzte ein kleines Gefährt aus Metall, als könnte es jederzeit losrollen."
        ]
      },
      {
        key: "farbfleck",
        name: "Farbfleck",
        articleAcc: "einen",
        hints: [
          "Auf einem alten Holzbrett breitete sich ein verirrter Klecks aus, als hätte jemand heimlich mit Zauberfarben gemalt."
        ]
      },
      {
        key: "buch",
        name: "Buch",
        articleAcc: "ein",
        hints: [
          "Auf einem niedrigen Stein lag ein Bündel schwerer Seiten, aus denen leise Geschichten in die Nacht zu flüstern schienen."
        ]
      },
      {
        key: "giesskanne",
        name: "Gießkanne",
        articleAcc: "eine",
        hints: [
          "Zwischen feuchten Blättern schimmerte ein schlanker Metallbügel, an dem noch glitzernde Tropfen hingen."
        ]
      },
      {
        key: "kerze",
        name: "Kerze",
        articleAcc: "eine",
        hints: [
          "Mitten im Windschatten eines Felsens ragte ein schmales Stück Wachs aus einem kleinen Halter, bereit, eine Flamme zu tragen."
        ]
      },
      {
        key: "blume",
        name: "Blume",
        articleAcc: "eine",
        hints: [
          "Aus der Ritze zwischen den Steinen reckte sich ein zarter Stängel, auf dem sich langsam eine Knospe öffnete."
        ]
      },
      {
        key: "fisch",
        name: "Fisch",
        articleAcc: "einen",
        hints: [
          "Direkt unter der Wasseroberfläche schoss ein schmaler Schatten hin und her, begleitet von winzigen glitzernden Wellen."
        ]
      },
      {
        key: "schmetterling",
        name: "Schmetterling",
        articleAcc: "einen",
        hints: [
          "Über der Lichtung schwebte ein leichtes Flattern, als würde ein Stückchen Luft selbst tanzen."
        ]
      },
      {
        key: "schuh",
        name: "Schuh",
        articleAcc: "einen",
        hints: [
          "Am Rand des Pfades stand ein einzelnes Fußabdruck-Wunder, noch mit getrocknetem Staub am Rand der Sohle."
        ]
      },
      {
        key: "tasse",
        name: "Tasse",
        articleAcc: "eine",
        hints: [
          "Auf einem flachen Stein wartete ein kleiner Rand, in dem ein Rest unsichtbarer Wärme zu stecken schien."
        ]
      },
      {
        key: "tshirt",
        name: "T-Shirt",
        articleAcc: "ein",
        hints: [
          "Über einem Ast baumelte ein Stück Stoff, das sich im Wind wie eine kleine Fahne blähte."
        ]
      }
    ];

    const colors = [
      { key: "Blau", desc: "tiefem Blau" },
      { key: "Violett", desc: "schimmerndem Violett" },
      { key: "Grün", desc: "lebendigem Grün" },
      { key: "Orange", desc: "warmem Orange" }
    ];

    const envIntros = [
      "Der Abendwald lag still, als der Nebel zwischen den Stämmen schwebte und jedes Geräusch wie ein Geheimnis klingen ließ.",
      "Über einer versteckten Lichtung hing die Luft schwer von Moosduft, während fern ein kaum hörbares Summen vibrierte.",
      "In einem vergessenen Innenhof bröckelte altes Mauerwerk, und kleine Funken von Sternenlicht tasteten sich über die Steine.",
      "Am Rand eines leisen Baches funkelten Kiesel wie sternenstaub, während das Wasser Geschichten über ferne Orte murmelte."
    ];

    const pathFragments = [
      "Eine neugierige Gestalt folgte dem Gefühl, dass hier etwas Besonderes auf sie wartete.",
      "Jemand spürte, dass genau an diesem Ort ein kleines Wunder versteckt sein musste.",
      "Ein leiser Windstoß schien jemanden sanft in die richtige Richtung zu stupsen.",
      "Es war, als würde ein unsichtbarer Faden jemanden direkt zu einem geheimen Fund führen."
    ];

    // -----------------------------
    // Zustand
    // -----------------------------
    let currentStoryParts = [];
    let currentPartIndex = -1;
    let storyFromThisDevice = false; // Hat dieses Handy die aktuelle Fairy gestartet?
    let storyActive = false;

    let points = 0;
    let fairiesCalled = 0;
    const maxFairies = 6;

    // -----------------------------
    // DOM-Elemente
    // -----------------------------
    const fairyButton = document.getElementById("fairyButton");
    const storyBox = document.getElementById("storyBox");
    const storyStatus = document.getElementById("storyStatus");
    const nextPartButton = document.getElementById("nextPartButton");
    const fairyKippButton = document.getElementById("fairyKippButton");
    const ohneKippButton = document.getElementById("ohneKippButton");
    const scorePointsEl = document.getElementById("scorePoints");
    const scoreFairiesEl = document.getElementById("scoreFairies");
    const fairyEndLabel = document.getElementById("fairyEndLabel");

    // -----------------------------
    // Helper
    // -----------------------------
    function rand(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function updateScoreUI() {
      scorePointsEl.textContent = points.toString();
      scoreFairiesEl.textContent = `Erzählte Fairies: ${fairiesCalled} / ${maxFairies}`;

      if (fairiesCalled >= maxFairies) {
        fairyEndLabel.textContent = "FAIRY END";
        fairyButton.classList.add("disabled");
      } else {
        fairyEndLabel.textContent = "";
        fairyButton.classList.remove("disabled");
      }
    }

    function setStoryPlaceholder() {
      storyBox.innerHTML =
        '<div class="story-placeholder">Tippe auf <span class="highlight-color">FAIRY</span>, um eine neue Fairy-Geschichte zu erhalten.</div>';
      storyStatus.textContent = "noch keine Fairy";
      nextPartButton.classList.add("disabled");
    }

    function renderCurrentPart() {
      if (!currentStoryParts.length || currentPartIndex < 0) {
        setStoryPlaceholder();
        return;
      }

      storyBox.textContent = currentStoryParts[currentPartIndex];
      storyStatus.textContent = `Abschnitt ${currentPartIndex + 1} von ${currentStoryParts.length}`;

      if (currentPartIndex >= currentStoryParts.length - 1) {
        nextPartButton.classList.add("disabled");
      } else {
        nextPartButton.classList.remove("disabled");
      }
    }

    // -----------------------------
    // Story generieren
    // -----------------------------
    function generateFairyStory() {
      const motif = rand(motifs);
      const color = rand(colors);

      const intro = rand(envIntros);
      const path = rand(pathFragments);
      const hint = rand(motif.hints);

      const ending = `Am Ende des Weges lag ${motif.articleAcc} ${motif.name} in leuchtendem ${color.key}.`;

      return {
        parts: [intro, path + " " + hint, ending],
        motifKey: motif.key,
        colorKey: color.key
      };
    }

    // -----------------------------
    // Event-Logik
    // -----------------------------
    fairyButton.addEventListener("click", () => {
      if (fairiesCalled >= maxFairies) {
        return; // Keine neue Fairy mehr
      }

      const story = generateFairyStory();
      currentStoryParts = story.parts;
      currentPartIndex = 0;
      storyFromThisDevice = true;
      storyActive = true;

      fairiesCalled += 1;
      updateScoreUI();
      renderCurrentPart();
    });

    nextPartButton.addEventListener("click", () => {
      if (nextPartButton.classList.contains("disabled")) return;
      if (!currentStoryParts.length) return;

      if (currentPartIndex < currentStoryParts.length - 1) {
        currentPartIndex += 1;
        renderCurrentPart();
      }
    });

    // Punkte-Buttons

    fairyKippButton.addEventListener("click", () => {
      // 3 Punkte, wenn eigene Fairy; sonst 2
      if (storyFromThisDevice) {
        points += 3;
      } else {
        points += 2;
      }
      updateScoreUI();

      // Nach einer gewerteten Fairy ist für dieses Handy keine aktive Fairy mehr gekoppelt
      storyFromThisDevice = false;
      storyActive = false;
      currentStoryParts = [];
      currentPartIndex = -1;
      setStoryPlaceholder();
    });

    ohneKippButton.addEventListener("click", () => {
      // 1 Punkt, wenn Fairy ohne Kipp getroffen wurde
      points += 1;
      updateScoreUI();

      storyFromThisDevice = false;
      storyActive = false;
      currentStoryParts = [];
      currentPartIndex = -1;
      setStoryPlaceholder();
    });

    // Initial
    updateScoreUI();
    setStoryPlaceholder();
  </script>
</body>
</html>
