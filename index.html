<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Fairy KIPP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --blue: rgb(0, 101, 171);
      --violet: rgb(170, 0, 120);
      --green: rgb(59, 165, 43);
      --orange: rgb(242, 150, 0);
      --lindgreen: rgb(191, 212, 188);

      --bg-dark: #05070b;
      --card-bg: #11141c;
      --card-alt-bg: #181c26;
      --text-main: #f5f7ff;
      --text-muted: #a7afc5;
      --border-soft: #252a39;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.6);
      --radius-lg: 24px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #202b3d 0, #05070b 55%);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .app-frame {
      width: 100%;
      max-width: 480px;
      background: linear-gradient(145deg, #0b0e15, #05070b);
      border-radius: 32px;
      padding: 20px 18px 24px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(255, 255, 255, 0.04);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .title {
      text-align: center;
      margin-bottom: 4px;
    }

    .title-line {
      font-size: 26px;
      font-weight: 700;
      letter-spacing: 0.05em;
    }

    .title-line span.fairy {
      font-family: "Segoe Script", "Bradley Hand", system-ui;
      font-weight: 600;
      color: var(--orange);
      text-shadow: 0 0 14px rgba(242, 150, 0, 0.9);
    }

    .title-line span.kipp {
      color: var(--blue);
    }

    .subtitle {
      font-size: 12px;
      color: var(--text-muted);
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin-top: 2px;
    }

    .fairy-btn-wrap {
      display: flex;
      justify-content: center;
      margin-top: 4px;
    }

    .fairy-btn {
      min-width: 190px;
      padding: 16px 32px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: #111;
      background: radial-gradient(circle at top, #ffd37a 0, #f29600 40%, #c57300 100%);
      box-shadow:
        0 0 0 2px rgba(0, 0, 0, 0.6),
        0 0 24px rgba(242, 150, 0, 0.9),
        0 14px 26px rgba(0, 0, 0, 0.5);
      position: relative;
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out,
        filter 0.08s ease-out;
    }

    .fairy-btn::after {
      content: "";
      position: absolute;
      inset: 4px;
      border-radius: inherit;
      border: 1px dashed rgba(255, 255, 255, 0.45);
      pointer-events: none;
    }

    .fairy-btn:active {
      transform: translateY(1px) scale(0.99);
      box-shadow:
        0 0 0 2px rgba(0, 0, 0, 0.7),
        0 6px 14px rgba(0, 0, 0, 0.7);
      filter: brightness(0.96);
    }

    .fairy-btn:disabled {
      opacity: 0.55;
      cursor: default;
      box-shadow:
        0 0 0 1px rgba(0, 0, 0, 0.4),
        0 4px 10px rgba(0, 0, 0, 0.5);
      filter: grayscale(0.1) brightness(0.8);
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 14px 16px 16px;
      border: 1px solid var(--border-soft);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .story-header {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .story-box {
      margin-top: 2px;
      padding: 12px 12px;
      border-radius: 18px;
      background: linear-gradient(145deg, #171c26, #10131c);
      border: 1px solid rgba(255, 255, 255, 0.04);
      min-height: 72px;
      display: flex;
      align-items: center;
      font-size: 14px;
      line-height: 1.5;
      color: #e4e8ff;
    }

    .story-placeholder {
      opacity: 0.7;
      font-style: italic;
    }

    .story-actions {
      display: flex;
      justify-content: flex-end;
    }

    .btn-weiter {
      border-radius: var(--radius-pill);
      border: none;
      padding: 8px 18px;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      background: transparent;
      color: var(--violet);
      cursor: pointer;
      border: 1px solid rgba(170, 0, 120, 0.4);
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.6);
      transition: background 0.12s ease-out, color 0.12s ease-out,
        border-color 0.12s ease-out, transform 0.08s ease-out;
    }

    .btn-weiter:disabled {
      opacity: 0.45;
      border-color: rgba(255, 255, 255, 0.08);
      cursor: default;
      transform: none;
    }

    .btn-weiter:not(:disabled):active {
      transform: translateY(1px);
      background: rgba(170, 0, 120, 0.12);
    }

    .fund-section {
      background: var(--card-alt-bg);
      border-radius: var(--radius-lg);
      padding: 12px 14px 14px;
      border: 1px solid var(--border-soft);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .fund-actions {
      display: flex;
      justify-content: center;
    }

    .btn-fund {
      min-width: 180px;
      padding: 12px 20px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 15px;
      font-weight: 700;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      background: linear-gradient(145deg, var(--blue), var(--green));
      color: #f7fbff;
      box-shadow:
        0 0 0 1px rgba(0, 0, 0, 0.7),
        0 8px 18px rgba(0, 0, 0, 0.7);
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out,
        filter 0.08s ease-out;
    }

    .btn-fund:active {
      transform: translateY(1px) scale(0.99);
      box-shadow:
        0 0 0 1px rgba(0, 0, 0, 0.8),
        0 4px 10px rgba(0, 0, 0, 0.8);
      filter: brightness(0.94);
    }

    .btn-fund:disabled {
      opacity: 0.5;
      cursor: default;
      filter: grayscale(0.1) brightness(0.86);
    }

    .fund-hint {
      text-align: center;
      font-size: 11px;
      color: var(--text-muted);
    }

    .score-card {
      background: transparent;
      border-radius: var(--radius-lg);
      padding: 8px 6px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .score-label {
      font-size: 11px;
      letter-spacing: 0.24em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .score-value {
      font-size: 40px;
      font-weight: 800;
      letter-spacing: 0.08em;
    }

    .score-detail {
      font-size: 12px;
      color: var(--text-muted);
    }

    .end-overlay {
      position: absolute;
      inset: 0;
      border-radius: 32px;
      background: radial-gradient(circle at top, rgba(242, 150, 0, 0.16), transparent 55%),
                  rgba(3, 4, 8, 0.98);
      display: none;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 24px;
      flex-direction: column;
      gap: 14px;
    }

    .end-overlay.active {
      display: flex;
    }

    .end-title {
      font-size: 28px;
      font-weight: 800;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--orange);
      text-shadow: 0 0 18px rgba(242, 150, 0, 0.9);
    }

    .end-score {
      font-size: 56px;
      font-weight: 900;
      letter-spacing: 0.08em;
      margin-top: 4px;
    }

    .end-sub {
      font-size: 13px;
      color: var(--text-muted);
    }

    .btn-newgame {
      margin-top: 10px;
      padding: 11px 26px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(145deg, var(--green), var(--blue));
      color: #f7fbff;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      cursor: pointer;
      box-shadow:
        0 0 0 1px rgba(0, 0, 0, 0.75),
        0 10px 22px rgba(0, 0, 0, 0.8);
    }

    @media (max-width: 360px) {
      .title-line {
        font-size: 22px;
      }
      .fairy-btn {
        min-width: 0;
        width: 100%;
        font-size: 18px;
      }
      .btn-fund {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="app-frame">
    <div class="content-wrap" style="position: relative;">
      <div class="title">
        <div class="title-line">
          <span class="fairy">Fairy</span> <span class="kipp">KIPP</span>
        </div>
        <div class="subtitle">Unendlich viele Kipp-Geschichten</div>
      </div>

      <div class="fairy-btn-wrap">
        <button id="fairyBtn" class="fairy-btn">FAIRY</button>
      </div>

      <div class="card">
        <div class="story-header">
          <span>Fairy-Geschichte</span>
          <span id="sectionLabel">Abschnitt 0 von 3</span>
        </div>
        <div id="storyBox" class="story-box">
          <span class="story-placeholder">
            Tippe auf FAIRY, lies die Geschichte vor – dann wird gekippt.
          </span>
        </div>
        <div class="story-actions">
          <button id="nextBtn" class="btn-weiter" disabled>Weiter</button>
        </div>
      </div>

      <div class="fund-section">
        <div class="fund-actions">
          <button id="fundBtn" class="btn-fund" disabled>FAIRY-FUND</button>
        </div>
        <div class="fund-hint">
          Tippe FAIRY-FUND, wenn du die aktuelle Fairy getroffen oder bereits aufgelegt hattest.
        </div>
      </div>

      <div class="score-card">
        <div class="score-label">Fairy-Punkte</div>
        <div id="scoreValue" class="score-value">0</div>
        <div id="scoreDetail" class="score-detail">Erzählte Fairies: 0 / 6</div>
      </div>

      <div id="endOverlay" class="end-overlay">
        <div class="end-title">Fairy-End</div>
        <div id="endScore" class="end-score">0</div>
        <div class="end-sub">
          Deine Fairy-Punkte in dieser Partie.<br />
          Starte gern eine neue Runde.
        </div>
        <button id="newGameBtn" class="btn-newgame">Neue Partie</button>
      </div>
    </div>
  </div>

  <script>
    // ----------------------
    // Spielzustand
    // ----------------------
    const fairyBtn = document.getElementById("fairyBtn");
    const nextBtn = document.getElementById("nextBtn");
    const fundBtn = document.getElementById("fundBtn");
    const storyBox = document.getElementById("storyBox");
    const sectionLabel = document.getElementById("sectionLabel");
    const scoreValue = document.getElementById("scoreValue");
    const scoreDetail = document.getElementById("scoreDetail");
    const endOverlay = document.getElementById("endOverlay");
    const endScore = document.getElementById("endScore");
    const newGameBtn = document.getElementById("newGameBtn");

    let currentStory = null;
    let currentSectionIndex = 0;

    let fairyPoints = 0;
    let narratedFairies = 0;
    const MAX_FAIRIES = 6;
    let narratedSinceLastScore = false; // true = eigene Fairy möglich
    let gameOver = false;

    // Merker, damit das Farbadjektiv nicht ständig wiederholt wird
    let lastColorAdjective = null;

    // ----------------------
    // Daten: Motive & Farben
    // ----------------------
    const motifs = [
      { key: "wasserball", name: "Wasserball" },
      { key: "auto", name: "Auto" },
      { key: "farbfleck", name: "Farbfleck" },
      { key: "buch", name: "Buch" },
      { key: "giesskanne", name: "Gießkanne" },
      { key: "kerze", name: "Kerze" },
      { key: "blume", name: "Blume" },
      { key: "fisch", name: "Fisch" },
      { key: "schmetterling", name: "Schmetterling" },
      { key: "schuh", name: "Schuh" },
      { key: "tasse", name: "Tasse" },
      { key: "tshirt", name: "T-Shirt" }
    ];

    const colors = [
      { key: "blau", label: "Blau" },
      { key: "violett", label: "Violett" },
      { key: "orange", label: "Orange" },
      { key: "grün", label: "Grün" }
    ];

    const colorAdjectives = [
      "leuchtendem",
      "tiefem",
      "zartem",
      "warmem",
      "klarem",
      "sanftem",
      "hellen",
      "mystischem"
    ];

    // Hilfsfunktion
    function randItem(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function pickColorAdjective() {
      let adj;
      for (let i = 0; i < 5; i++) {
        adj = randItem(colorAdjectives);
        if (adj !== lastColorAdjective) break;
      }
      lastColorAdjective = adj;
      return adj;
    }

    // ----------------------
    // Fairy-Generator
    // ----------------------
    function generateFairyStory() {
      const motif = randItem(motifs);
      const color = randItem(colors);
      const adj = pickColorAdjective();

      // neutrale „Erzählstimme“ ohne Motiv-Wort
      const openingTemplates = [
        "Der Abend legte sich wie ein flüsternder Schleier über den Weg, und irgendwo zwischen den Schatten schien etwas auf einen Moment der Aufmerksamkeit zu warten.",
        "Ein leiser Wind strich über den Boden, als würde er heimlich jemanden einladen, genauer hinzusehen.",
        "Zwischen den Bäumen wurde die Luft dichter, als hätte jemand dort einen winzigen Funken Zauber versteckt.",
        "Über dem Weg hing ein fast unsichtbares Kitzeln, so als würde etwas Kleines den Mut sammeln, entdeckt zu werden."
      ];

      const hintTemplates = [
        "Nicht weit davon glitzerte eine kleine Form, rund und doch irgendwie verspielt, als hätte jemand sie mitten in einer Bewegung angehalten.",
        "In einer flachen Vertiefung lag etwas, das wie ein stiller Begleiter aussah – bereit, in die Hand genommen zu werden.",
        "Zwischen ein paar Steinen ruhte ein kleines Ding, als würde es schon lange darauf warten, endlich beachtet zu werden.",
        "Auf einem Fleck, wo sich Licht und Schatten trafen, zeichnete sich eine Kontur ab, die fast so wirkte, als hätte sie eine eigene Geschichte."
      ];

      const finaleTemplates = [
        `Und als der Blick schließlich genau dort zum Stillstand kam, lag vor allen Augen ein ${motif.name} in ${adj} ${color.label}.`,
        `Ganz am Ende des Weges wartete wie zufällig ein ${motif.name} in ${adj} ${color.label}.`,
        `Mit einem Mal war alles klar: Mitten im Bild lag ein ${motif.name} in ${adj} ${color.label}.`,
        `Und da, genau dort, wo niemand mehr damit rechnete, fand man ein ${motif.name} in ${adj} ${color.label}.`
      ];

      const sections = [
        randItem(openingTemplates),
        randItem(hintTemplates),
        randItem(finaleTemplates)
      ];

      return {
        motif,
        color,
        sections
      };
    }

    // ----------------------
    // UI-Helfer
    // ----------------------
    function updateStoryBox(text, isPlaceholder = false) {
      storyBox.innerHTML = "";
      const span = document.createElement("span");
      span.textContent = text;
      if (isPlaceholder) span.classList.add("story-placeholder");
      storyBox.appendChild(span);
    }

    function updateSectionLabel() {
      sectionLabel.textContent = `Abschnitt ${currentSectionIndex} von 3`;
    }

    function updateScore() {
      scoreValue.textContent = fairyPoints.toString();
      scoreDetail.textContent = `Erzählte Fairies: ${narratedFairies} / ${MAX_FAIRIES}`;
    }

    function showEndOverlay() {
      gameOver = true;
      endScore.textContent = fairyPoints.toString();
      endOverlay.classList.add("active");

      fairyBtn.disabled = true;
      nextBtn.disabled = true;
      fundBtn.disabled = true;
    }

    function resetGame() {
      fairyPoints = 0;
      narratedFairies = 0;
      narratedSinceLastScore = false;
      currentStory = null;
      currentSectionIndex = 0;
      gameOver = false;

      updateStoryBox(
        "Tippe auf FAIRY, lies die Geschichte vor – dann wird gekippt.",
        true
      );
      updateSectionLabel();
      updateScore();

      fairyBtn.disabled = false;
      nextBtn.disabled = true;
      fundBtn.disabled = true;
      endOverlay.classList.remove("active");
    }

    // ----------------------
    // Ereignisse
    // ----------------------
    fairyBtn.addEventListener("click", () => {
      if (gameOver) return;

      currentStory = generateFairyStory();
      currentSectionIndex = 1;
      narratedSinceLastScore = true;
      narratedFairies = Math.min(narratedFairies + 1, MAX_FAIRIES);

      updateStoryBox(currentStory.sections[0]);
      updateSectionLabel();

      nextBtn.disabled = false;
      fundBtn.disabled = true;

      updateScore();

      if (narratedFairies >= MAX_FAIRIES) {
        // Spieler hat seine sechste Fairy gestartet – Endbild nach der nächsten Wertung
        // (das eigentliche Fairy-End passiert dann nach dem nächsten FAIRY-FUND-Klick)
      }
    });

    nextBtn.addEventListener("click", () => {
      if (!currentStory) return;

      currentSectionIndex++;
      if (currentSectionIndex >= 3) {
        currentSectionIndex = 3;
        nextBtn.disabled = true;
        fundBtn.disabled = false;
      }

      const text =
        currentStory.sections[currentSectionIndex - 1] || currentStory.sections[2];
      updateStoryBox(text);
      updateSectionLabel();
    });

    fundBtn.addEventListener("click", () => {
      if (!currentStory || gameOver) return;

      if (narratedSinceLastScore) {
        fairyPoints += 3; // eigene Fairy erkippt
      } else {
        fairyPoints += 2; // Fairy von jemand anderem / aufgelegt
      }
      narratedSinceLastScore = false;

      updateScore();

      // Story ist für diese Runde erledigt
      currentStory = null;
      currentSectionIndex = 0;
      updateStoryBox(
        "Fairy gewertet. Wenn du wieder an der Reihe bist, tippe erneut auf FAIRY.",
        true
      );
      updateSectionLabel();
      nextBtn.disabled = true;
      fundBtn.disabled = true;

      if (narratedFairies >= MAX_FAIRIES) {
        showEndOverlay();
      }
    });

    newGameBtn.addEventListener("click", resetGame);

    // Wenn ein Spieler eine fremde Fairy trifft oder eine aufgelegte Fairy hat,
    // tippt er einfach FAIRY-FUND, ohne vorher FAIRY gedrückt zu haben.
    // Damit weiß die App automatisch: 2 Punkte statt 3.
    // Deshalb setzen wir narratedSinceLastScore zusätzlich auf false,
    // wenn längere Zeit keine eigene Fairy gestartet wurde,
    // aber das ist hier nicht nötig – ein Fremd-Treffer beginnt immer
    // mit "nur FAIRY-FUND" auf diesem Handy.

    // Startzustand
    resetGame();
  </script>
</body>
</html>
