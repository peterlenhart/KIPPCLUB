<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Fairy KIPP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050910;
      --card: #101722;
      --card-soft: #151d2a;
      --accent-orange: #f29600;
      --accent-blue: #0065ab;   /* 0/101/171 */
      --accent-green: #3ba52b;  /* 59/165/43 */
      --text-main: #f7f7f7;
      --text-soft: #c6ceda;
      --text-muted: #7c889a;
      --border-soft: #283344;
      --danger: #e14b4b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #10192b 0, #050910 55%, #020409 100%);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 12px;
    }

    .app-frame {
      width: 100%;
      max-width: 460px;
      border-radius: 32px;
      background: radial-gradient(circle at top, #151f30 0, #050910 55%);
      box-shadow:
        0 24px 80px rgba(0, 0, 0, 0.85),
        0 0 0 1px rgba(255, 255, 255, 0.02);
      padding: 18px 16px 22px;
      position: relative;
    }

    /* Fake Notch */
    .notch {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 140px;
      height: 30px;
      border-radius: 999px;
      background: radial-gradient(circle at top, #222c3f 0, #050910 70%);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .notch-dot {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #ffffff 0, #b8c4d8 40%, #1b2435 80%);
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.25);
    }

    .header {
      padding-top: 30px;
      padding-bottom: 8px;
      text-align: center;
    }

    .title-main {
      font-size: 26px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-weight: 700;
    }

    .title-main span.fairy {
      font-family: "Segoe Script", "Bradley Hand", cursive;
      font-size: 26px;
      color: #ffd466;
      text-shadow:
        0 0 8px rgba(255, 212, 102, 0.6),
        0 0 18px rgba(255, 255, 255, 0.4);
      margin-right: 4px;
    }

    .title-main span.kipp {
      color: var(--accent-blue);
      text-shadow:
        0 0 10px rgba(0, 101, 171, 0.8),
        0 0 20px rgba(0, 101, 171, 0.6);
    }

    /* FAIRY Button */

    .fairy-button-wrapper {
      margin-top: 12px;
      margin-bottom: 18px;
      display: flex;
      justify-content: center;
    }

    .fairy-button-glow {
      position: relative;
      padding: 2px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 0, rgba(255, 255, 255, 0.18), transparent 55%),
        radial-gradient(circle at 50% 130%, rgba(255, 184, 77, 0.7), transparent 65%),
        radial-gradient(circle at -10% 50%, rgba(0, 101, 171, 0.8), transparent 65%);
      box-shadow:
        0 0 40px rgba(0, 0, 0, 0.7),
        0 0 32px rgba(255, 184, 77, 0.45);
    }

    .fairy-button-glow::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 999px;
      border: 2px dashed rgba(0, 0, 0, 0.4);
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .btn-fairy-main {
      border: none;
      outline: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 14px 56px;
      border-radius: 999px;
      font-size: 22px;
      font-weight: 800;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #2c1b03;
      background: radial-gradient(circle at 20% 0, #ffe792 0, #f6b83b 35%, #f29600 100%);
      box-shadow:
        0 10px 26px rgba(0, 0, 0, 0.9),
        0 0 22px rgba(242, 150, 0, 0.9);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .btn-fairy-main:active {
      transform: translateY(1px) scale(0.99);
      box-shadow:
        0 6px 18px rgba(0, 0, 0, 0.8),
        0 0 16px rgba(242, 150, 0, 0.75);
    }

    .btn-fairy-main[disabled] {
      opacity: 0.5;
      cursor: default;
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.7);
    }

    /* Story Card */

    .card {
      background: linear-gradient(135deg, var(--card) 0, var(--card-soft) 100%);
      border-radius: 24px;
      padding: 14px 14px 12px;
      box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.85),
        0 0 0 1px rgba(255, 255, 255, 0.025);
      border: 1px solid rgba(255, 255, 255, 0.02);
    }

    .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .story-box {
      margin-top: 4px;
      border-radius: 18px;
      padding: 10px 12px;
      min-height: 88px;
      background: radial-gradient(circle at top, #1b2637 0, #121927 60%, #0f1520 100%);
      border: 1px solid var(--border-soft);
      display: flex;
      align-items: center;
      justify-content: flex-start;
      color: var(--text-soft);
      font-size: 15px;
      line-height: 1.4;
    }

    .story-placeholder {
      opacity: 0.72;
      font-size: 14px;
    }

    .story-controls {
      margin-top: 8px;
      display: flex;
      justify-content: flex-end;
    }

    .btn-secondary {
      min-width: 120px;
      padding: 8px 18px;
      border-radius: 999px;
      font-size: 13px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
    }

    .btn-secondary[disabled] {
      opacity: 0.35;
      cursor: default;
    }

    /* Action buttons */

    .actions-row {
      margin-top: 14px;
      display: flex;
      gap: 10px;
    }

    .btn-action {
      flex: 1;
      border-radius: 999px;
      padding: 11px 10px;
      border: none;
      font-size: 15px;
      font-weight: 700;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      cursor: pointer;
      color: #ffffff;
      box-shadow: 0 11px 22px rgba(0, 0, 0, 0.9);
    }

    .btn-action:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 7px 16px rgba(0, 0, 0, 0.85);
    }

    .btn-action[disabled] {
      opacity: 0.4;
      cursor: default;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.75);
    }

    .btn-fairy-kipp {
      background: linear-gradient(135deg, #0076d1 0, var(--accent-blue) 65%, #00436b 100%);
    }

    .btn-ohne-kipp {
      background: linear-gradient(135deg, #4dcc3e 0, var(--accent-green) 70%, #226d16 100%);
    }

    /* Scoreboard */

    .score-card {
      margin-top: 14px;
      padding: 10px 14px 12px;
      border-radius: 20px;
      background: linear-gradient(145deg, #0b111b 0, #050910 65%);
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    .score-label {
      font-size: 12px;
      color: var(--text-muted);
      letter-spacing: 0.16em;
      text-transform: uppercase;
    }

    .score-value {
      font-size: 26px;
      font-weight: 800;
      margin-top: 6px;
      margin-bottom: 4px;
    }

    .score-sub {
      font-size: 13px;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .score-sub span.ended {
      color: #ffd466;
      font-weight: 600;
    }

    /* Fairy END overlay */

    .end-overlay {
      position: absolute;
      inset: 0;
      border-radius: 32px;
      background: linear-gradient(145deg, rgba(2, 4, 9, 0.98), rgba(6, 10, 20, 0.98));
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      text-align: center;
      z-index: 20;
    }

    .end-overlay.active {
      display: flex;
    }

    .end-box {
      max-width: 320px;
      width: 100%;
      padding: 22px 18px 20px;
      border-radius: 26px;
      background: radial-gradient(circle at top, #182234 0, #050910 80%);
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .end-title {
      font-size: 22px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      margin-bottom: 6px;
    }

    .end-title span {
      color: #ffd466;
      text-shadow: 0 0 10px rgba(255, 212, 102, 0.8);
    }

    .end-points {
      font-size: 40px;
      font-weight: 900;
      margin: 10px 0 4px;
    }

    .end-text {
      font-size: 14px;
      color: var(--text-soft);
      margin-bottom: 14px;
    }

    .btn-end-close {
      margin-top: 4px;
      padding: 9px 22px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: transparent;
      color: var(--text-soft);
      font-size: 13px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      cursor: pointer;
    }

    .btn-end-close:active {
      transform: translateY(1px);
    }

    @media (max-width: 390px) {
      .title-main {
        font-size: 24px;
      }

      .btn-fairy-main {
        padding-inline: 42px;
        font-size: 20px;
      }

      .score-value {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="app-frame">
    <div class="notch"><div class="notch-dot"></div></div>

    <div class="header">
      <div class="title-main">
        <span class="fairy">Fairy</span>
        <span class="kipp">KIPP</span>
      </div>
    </div>

    <div class="fairy-button-wrapper">
      <div class="fairy-button-glow">
        <button id="btnFairy" class="btn-fairy-main">FAIRY</button>
      </div>
    </div>

    <div class="card">
      <div class="card-header-row">
        <span>Fairy-Geschichte</span>
        <span id="sectionInfo">Abschnitt 0 von 3</span>
      </div>
      <div id="storyBox" class="story-box">
        <span id="storyText" class="story-placeholder">
          Klicke auf <strong>FAIRY</strong>, um eine neue zauberhafte Geschichte zu starten.
        </span>
      </div>
      <div class="story-controls">
        <button id="btnWeiter" class="btn-secondary" disabled>WEITER</button>
      </div>
    </div>

    <div class="actions-row">
      <button id="btnFairyKipp" class="btn-action btn-fairy-kipp" disabled>FAIRY KIPP</button>
      <button id="btnOhneKipp" class="btn-action btn-ohne-kipp" disabled>OHNE KIPP</button>
    </div>

    <div class="score-card">
      <div class="score-label">Fairy-Punkte</div>
      <div id="scoreValue" class="score-value">0</div>
      <div class="score-sub">
        <span id="fairiesInfo">Erzählte Fairies: 0 / 6</span>
        <span id="endHint" class="ended"></span>
      </div>
    </div>

    <div id="endOverlay" class="end-overlay">
      <div class="end-box">
        <div class="end-title"><span>FAIRY END</span></div>
        <div class="end-points" id="endPoints">0</div>
        <div class="end-text">
          Deine Fairy-Reise ist für diese Runde beendet.<br />
          Merkt euch eure Punkte und wartet, bis alle Spieler fertig sind.
        </div>
        <button id="btnCloseEnd" class="btn-end-close">OK</button>
      </div>
    </div>
  </div>

  <script>
    // -----------------------------
    // Daten & kleines "Grammatikmodul"
    // -----------------------------

    const motifs = [
      { key: 'wasserball', name: 'Wasserball', gender: 'm' },
      { key: 'auto',       name: 'Auto',       gender: 'n' },
      { key: 'farbfleck',  name: 'Farbfleck',  gender: 'm' },
      { key: 'buch',       name: 'Buch',       gender: 'n' },
      { key: 'giesskanne', name: 'Gießkanne',  gender: 'f' },
      { key: 'kerze',      name: 'Kerze',      gender: 'f' },
      { key: 'blume',      name: 'Blume',      gender: 'f' },
      { key: 'fisch',      name: 'Fisch',      gender: 'm' },
      { key: 'schmetterling', name: 'Schmetterling', gender: 'm' },
      { key: 'schuh',      name: 'Schuh',      gender: 'm' },
      { key: 'tasse',      name: 'Tasse',      gender: 'f' },
      { key: 'tshirt',     name: 'T-Shirt',    gender: 'n' }
    ];

    const colors = [
      { key: 'blau',     word: 'Blau' },
      { key: 'violett',  word: 'Violett' },
      { key: 'orange',   word: 'Orange' },
      { key: 'gruen',    word: 'Grün' }
    ];

    // Pro Motiv eine kleine, sichere Struktur:
    // [ Satz 1 (Stimmung), Satz 2 (Hinweis) ]
    const motifHints = {
      wasserball: [
        "Zwischen den Wellen eines stillen Sees zogen kreisende Ringe über die Oberfläche, als hätte eben noch etwas Fröhliches darauf getanzt.",
        "Am Ufer lagen nasse Abdrücke im Sand, die aussahen, als wären sie von etwas Rundem und federndem hinterlassen worden."
      ],
      auto: [
        "Auf einem vergessenen Waldweg schimmerten Glassplitter im Abendlicht, als wollten sie von längst vergangenen Fahrten erzählen.",
        "Zwischen Farnen zeichnete sich eine Spur aus zwei glatten Linien ab, als hätten unsichtbare Räder dort leise ihre Runden gedreht."
      ],
      farbfleck: [
        "In einer alten Werkstatt roch es nach Papier, Staub und heimlichen Ideen, die nie ganz fertig wurden.",
        "Auf dem Boden breiteten sich getrocknete Spritzer aus, als hätte jemand seine Gedanken in Tropfen über die Welt geschüttelt."
      ],
      buch: [
        "Hinter einem knarrenden Regal flüsterte eine unsichtbare Brise durch vergessene Seiten.",
        "Zwischen den Brettern lugten winzige Papierfetzen hervor, als würden sie heimlich nach einer neugierigen Hand greifen."
      ],
      giesskanne: [
        "Auf einer verwilderten Lichtung raschelte das Gras, als ob etwas darin nach einem neuen Anfang suchte.",
        "Zwischen den Tropfen des Morgentaus glitzerte ein schmaler Metallbogen, bedeckt mit feinen Perlen, als hätte jemand Wasser in die Luft gemalt."
      ],
      kerze: [
        "In einem alten Turmraum flackerte kaum wahrnehmbares Licht, obwohl kein Feuer zu sehen war.",
        "Auf dem Tisch erstarrte eine dünne Spur aus erstarrtem Glanz, der in weichen Wellen den Rand hinunterlief."
      ],
      blume: [
        "Am Rand eines vergessenen Gartens summten Insekten so leise, als ob sie ein Lied nur für die Erde sangen.",
        "Zwischen den Steinen lugte ein zarter Stängel hervor, der den Himmel suchte, obwohl niemand ihn gepflanzt hatte."
      ],
      fisch: [
        "Unter der Oberfläche eines klaren Baches zitterten Schatten, die wie flüssige Pfeile durch das Wasser schossen.",
        "Zwischen den Steinen lagen winzige glänzende Schuppen, als hätte jemand heimlich Sternenstaub ins Wasser gestreut."
      ],
      schmetterling: [
        "Auf einer sonnigen Waldlichtung schwebte ein Staub aus Farben in der Luft, der jede Brise nutzte, um neue Formen zu zeichnen.",
        "An einem Ast hing etwas so Leichtes, dass selbst der Wind zögerte, es zu berühren."
      ],
      schuh: [
        "Entlang eines schmalen Pfades lagen vereinzelte Abdrücke im Matsch, die mitten im Nichts begannen.",
        "Zwischen Wurzeln steckte eine kleine Spur, als hätte jemand im Gehen plötzlich beschlossen zu fliegen."
      ],
      tasse: [
        "Auf einer Fensterbank im Dachgeschoss stand eine Pfütze aus erkaltetem Duft, der nach Geschichten aus längst vergangenen Abenden roch.",
        "Daneben zeichnete sich ein runder Rand auf dem Holz ab, als hätte jemand seinen Lieblingsplatz niemals ganz verlassen."
      ],
      tshirt: [
        "In einem verlassenen Kinderzimmer schaukelte ein Kleiderbügel im Luftzug der Erinnerung.",
        "Von der Decke fiel ein Streifen Licht auf eine Staubwolke, in der winzige Fäden tanzten wie eingefrorene Bewegungen."
      ]
    };

    function randomOf(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    // Grammatik-Helfer: liefert richtigen Akkusativ-Artikel
    function articleAccusative(gender) {
      switch (gender) {
        case 'm':
          return 'einen';
        case 'f':
          return 'eine';
        case 'n':
        default:
          return 'ein';
      }
    }

    // Baut den letzten Satz in einer festen, grammatikalisch sicheren Struktur.
    function buildFinalSentence(motif, color) {
      const art = articleAccusative(motif.gender);
      const colorWord = color.word.toLowerCase();
      return `Schließlich fand jemand ${art} ${motif.name} in leuchtendem ${colorWord}.`;
    }

    // Generiert eine Fairy: 3 Abschnitte (2 Hinweise + Auflösung)
    function generateFairy() {
      const motif = randomOf(motifs);
      const color = randomOf(colors);
      const hints = motifHints[motif.key];

      const s1 = hints[0];
      const s2 = hints[1];
      const s3 = buildFinalSentence(motif, color);

      return {
        motif,
        color,
        sections: [s1, s2, s3]
      };
    }

    // -----------------------------
    // App-Logik
    // -----------------------------

    const MAX_FAIRIES = 6;

    let currentFairy = null;
    let currentSection = 0;
    let score = 0;
    let toldFairies = 0;
    let gameEnded = false;

    const storyTextEl = document.getElementById('storyText');
    const sectionInfoEl = document.getElementById('sectionInfo');
    const scoreValueEl = document.getElementById('scoreValue');
    const fairiesInfoEl = document.getElementById('fairiesInfo');
    const endHintEl = document.getElementById('endHint');

    const btnFairy = document.getElementById('btnFairy');
    const btnWeiter = document.getElementById('btnWeiter');
    const btnFairyKipp = document.getElementById('btnFairyKipp');
    const btnOhneKipp = document.getElementById('btnOhneKipp');

    const endOverlay = document.getElementById('endOverlay');
    const endPointsEl = document.getElementById('endPoints');
    const btnCloseEnd = document.getElementById('btnCloseEnd');

    function updateScoreUI() {
      scoreValueEl.textContent = score;
      fairiesInfoEl.textContent = `Erzählte Fairies: ${toldFairies} / ${MAX_FAIRIES}`;
    }

    function resetStoryUI() {
      if (!currentFairy) {
        storyTextEl.textContent =
          "Klicke auf FAIRY, um eine neue zauberhafte Geschichte zu starten.";
        storyTextEl.classList.add('story-placeholder');
        sectionInfoEl.textContent = 'Abschnitt 0 von 3';
        btnWeiter.disabled = true;
      }
    }

    function showSection() {
      if (!currentFairy) {
        resetStoryUI();
        return;
      }
      const total = currentFairy.sections.length;
      const index = Math.min(currentSection, total - 1);
      storyTextEl.textContent = currentFairy.sections[index];
      storyTextEl.classList.remove('story-placeholder');
      sectionInfoEl.textContent = `Abschnitt ${index + 1} von ${total}`;
      btnWeiter.disabled = index >= total - 1;
    }

    function startNewFairy() {
      if (gameEnded) return;
      if (toldFairies >= MAX_FAIRIES) {
        triggerEnd();
        return;
      }

      currentFairy = generateFairy();
      currentSection = 0;
      toldFairies += 1;
      updateScoreUI();
      showSection();

      btnFairyKipp.disabled = false;
      btnOhneKipp.disabled = false;
    }

    function triggerEnd() {
      gameEnded = true;
      endHintEl.textContent = 'FAIRY END';
      endPointsEl.textContent = score;
      endOverlay.classList.add('active');

      btnFairy.disabled = true;
      btnWeiter.disabled = true;
      btnFairyKipp.disabled = true;
      btnOhneKipp.disabled = true;
    }

    // -----------------------------
    // Event-Handler
    // -----------------------------

    btnFairy.addEventListener('click', () => {
      if (gameEnded) return;
      startNewFairy();
    });

    btnWeiter.addEventListener('click', () => {
      if (!currentFairy || gameEnded) return;
      if (currentSection < currentFairy.sections.length - 1) {
        currentSection += 1;
        showSection();
      }
    });

    btnFairyKipp.addEventListener('click', () => {
      if (!currentFairy || gameEnded) return;

      // FAIRY KIPP:
      // Wenn der aktuelle Spieler der Erzähler war, ist das seine eigene Fairy.
      // Dafür 3 Punkte. (Das erkennt man daran, dass die Fairy auf dem eigenen Handy läuft.)
      score += 3;
      updateScoreUI();

      // Nach einem Kipp wird die aktuelle Fairy "verbraucht".
      currentFairy = null;
      resetStoryUI();
      btnFairyKipp.disabled = true;
      btnOhneKipp.disabled = true;

      if (toldFairies >= MAX_FAIRIES) {
        triggerEnd();
      }
    });

    btnOhneKipp.addEventListener('click', () => {
      if (!currentFairy || gameEnded) return;

      // OHNE KIPP:
      // Die Fairy lag schon aufgelegt – 1 Punkt.
      score += 1;
      updateScoreUI();

      currentFairy = null;
      resetStoryUI();
      btnFairyKipp.disabled = true;
      btnOhneKipp.disabled = true;

      if (toldFairies >= MAX_FAIRIES) {
        triggerEnd();
      }
    });

    btnCloseEnd.addEventListener('click', () => {
      endOverlay.classList.remove('active');
    });

    // Initial
    resetStoryUI();
    updateScoreUI();
  </script>
</body>
</html>
