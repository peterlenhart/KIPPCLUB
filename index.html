<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FAIRY KIPP</title>

  <style>
    :root {
      --blue:    #0065ab;  /* 0/101/171 */
      --violet:  #aa0078;  /* 170/0/120 */
      --green:   #3ba52b;  /* 59/165/43 */
      --orange:  #f29600;  /* 242/150/0 */
      --lind:    #bfd4bc;  /* 191/212/188 */
      --bg:      #f4f6fa;
      --text:    #1f2430;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #ffffff 0%, var(--bg) 55%, #dde3f0 100%);
      color: var(--text);
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 520px;
      padding: 20px 16px 32px;
    }

    .title {
      text-align: center;
      margin-bottom: 8px;
    }

    .title-main {
      font-size: 2.4rem;
      font-weight: 800;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--violet);
      text-shadow: 0 2px 0 rgba(0,0,0,0.09);
    }

    .title-sub {
      font-size: 1.05rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #555;
    }

    .score-row {
      display: flex;
      gap: 10px;
      margin: 16px 0 12px;
      flex-wrap: wrap;
    }

    .score-card {
      flex: 1;
      min-width: 150px;
      background: #ffffffdd;
      border-radius: 18px;
      padding: 10px 12px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .score-label {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #666;
    }

    .score-value {
      margin-top: 2px;
      font-size: 2.2rem;
      font-weight: 800;
    }

    .score-value.points {
      color: var(--orange);
    }

    .score-value.fairies {
      color: var(--blue);
    }

    .score-note {
      font-size: 0.8rem;
      color: #666;
      margin-top: 4px;
    }

    .fairy-end {
      margin-top: 8px;
      text-align: center;
      font-weight: 800;
      font-size: 1.2rem;
      color: var(--violet);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .btn-main {
      width: 100%;
      margin: 10px 0 14px;
      padding: 14px 0;
      border-radius: 999px;
      border: none;
      font-size: 1.3rem;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      background: linear-gradient(135deg, var(--blue), var(--violet));
      color: #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.18);
      cursor: pointer;
    }

    .btn-main:disabled {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
    }

    .story-box {
      background: rgba(255,255,255,0.95);
      border-radius: 18px;
      padding: 14px 14px 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      min-height: 140px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 8px;
    }

    .story-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .story-label {
      font-size: 0.9rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #555;
    }

    .story-target {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--green);
      text-align: right;
    }

    .story-text {
      font-size: 1.1rem;
      line-height: 1.35;
      font-weight: 500;
      margin-top: 6px;
    }

    .story-controls {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .btn-small {
      flex: 0 0 auto;
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      font-size: 0.95rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      background: var(--green);
      color: #fff;
    }

    .story-step-indicator {
      font-size: 0.8rem;
      color: #777;
    }

    .target-big {
      margin-top: 10px;
      text-align: center;
      font-size: 1.05rem;
      font-weight: 700;
      color: var(--blue);
    }

    .target-big span {
      font-weight: 800;
    }

    .points-area {
      margin-top: 18px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
    }

    .btn-points {
      border: none;
      border-radius: 16px;
      padding: 10px 6px;
      font-size: 1rem;
      font-weight: 800;
      text-align: center;
      cursor: pointer;
      color: #fff;
      box-shadow: 0 3px 10px rgba(0,0,0,0.12);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 4px;
    }

    .btn-points span.small {
      font-size: 0.8rem;
      font-weight: 600;
      opacity: 0.9;
    }

    .btn-self {
      background: var(--orange);
    }

    .btn-foreign {
      background: var(--blue);
    }

    .btn-laid {
      background: var(--green);
    }

    .btn-reset {
      margin-top: 14px;
      width: 100%;
      padding: 10px 0;
      border-radius: 999px;
      border: none;
      font-size: 0.95rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: rgba(0,0,0,0.04);
      color: #555;
      cursor: pointer;
    }

    .hint {
      margin-top: 8px;
      font-size: 0.8rem;
      color: #666;
      text-align: center;
    }

    @media (min-width: 768px) {
      .app {
        max-width: 640px;
      }
      .title-main {
        font-size: 2.8rem;
      }
      .story-box {
        min-height: 150px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="title">
      <div class="title-main">FAIRY KIPP</div>
      <div class="title-sub">unendliche Kipps &amp; Geschichten</div>
    </header>

    <section class="score-row">
      <div class="score-card">
        <div class="score-label">Fairy-Punkte</div>
        <div class="score-value points" id="scoreValue">0</div>
      </div>
      <div class="score-card">
        <div class="score-label">Erzählte Fairies</div>
        <div class="score-value fairies" id="fairyCountValue">0</div>
        <div class="score-note">max. 6 pro Partie</div>
      </div>
    </section>

    <div id="fairyEnd" class="fairy-end" style="display:none;">
      FAIRY END
    </div>

    <button id="btnNewFairy" class="btn-main">
      Neue Fairy starten
    </button>

    <section class="story-box" id="storyBox" style="display:none;">
      <div class="story-header">
        <div class="story-label">Aktuelle Fairy</div>
        <div class="story-target" id="storyTargetLabel">
          &nbsp;
        </div>
      </div>

      <div class="story-text" id="storyText">
        <!-- Satz für Satz -->
      </div>

      <div class="story-controls">
        <button class="btn-small" id="btnNextSentence">Weiter</button>
        <div class="story-step-indicator" id="storyStepIndicator"></div>
      </div>

      <div class="target-big" id="targetBig" style="display:none;">
        Gesucht: <span id="targetMotiv"></span> in <span id="targetColor"></span>
      </div>
    </section>

    <section class="points-area">
      <button class="btn-points btn-self" id="btnSelfHit">
        +3 Punkte
        <span class="small">Eigene Fairy gekippt</span>
      </button>
      <button class="btn-points btn-foreign" id="btnForeignHit">
        +2 Punkte
        <span class="small">Fremde Fairy gekippt</span>
      </button>
      <button class="btn-points btn-laid" id="btnLaidHit">
        +1 Punkt
        <span class="small">Fairy lag schon richtig</span>
      </button>
    </section>

    <button class="btn-reset" id="btnReset">
      Neues Spiel (Punkte & Fairies zurücksetzen)
    </button>

    <div class="hint">
      Reihenfolge am Tisch, Punkte &amp; Fairy-Ende werden von euch gemeinsam
      überwacht – die App verwaltet nur <b>deine</b> Punkte &amp; Geschichten.
    </div>
  </div>

  <script>
    // --- Daten für Motive & Farben --------------------------------------
    const MOTIVE = [
      "Wasserball",
      "Auto",
      "Farbfleck",
      "Buch",
      "Gießkanne",
      "Kerze",
      "Blume",
      "Fisch",
      "Schmetterling",
      "Schuh",
      "Tasse",
      "T-Shirt"
    ];

    const COLORS = [
      { name: "blau",    css: "var(--blue)"   },
      { name: "violett", css: "var(--violet)" },
      { name: "orange",  css: "var(--orange)" },
      { name: "grün",    css: "var(--green)"  }
    ];

    const PLACES = [
      "tief im Märchenwald",
      "auf einer versteckten Waldlichtung",
      "auf einem alten Dachboden",
      "in einer leisen Stadtgasse",
      "am Rand eines funkelnden Sees",
      "auf einer sonnigen Bergwiese",
      "unter einem knorrigen Baum",
      "im geheimen Hinterhof eines Zauberladens"
    ];

    const MOODS = [
      "neugierige",
      "mutige",
      "träumende",
      "etwas schüchterne",
      "fröhliche",
      "verspielte"
    ];

    const MAGIC_EVENTS = [
      "ein winziger Funke aus Sternenstaub",
      "eine lächelnde Wolke",
      "ein unsichtbarer Windhauch",
      "eine glitzernde Staubspur",
      "ein leiser Zauberflüstern",
      "ein scheues Lichtwesen"
    ];

    const HELPERS = [
      "ein kleines Eichhörnchen",
      "eine alte Eule",
      "ein freundlicher Frosch",
      "ein leiser Nachtfalter",
      "eine neugierige Maus",
      "ein wandernder Käfer"
    ];

    const FEELINGS = [
      "plötzlich ganz warm und mutig",
      "ganz leicht und frei",
      "zum ersten Mal richtig gesehen",
      "ein bisschen aufgeregt und glücklich",
      "still – und doch voller Freude",
      "endlich angekommen"
    ];

    // --- Spielzustand ---------------------------------------------------
    let score = 0;
    let fairyCount = 0;
    const maxFairies = 6;
    let gameStoryLocked = false; // neue Fairy gesperrt
    let fairyEndReached = false;

    let currentStory = null; // {sentences, index, motiv, color}
    let currentSentenceIndex = 0;

    // --- DOM-Elemente ---------------------------------------------------
    const scoreValueEl        = document.getElementById("scoreValue");
    const fairyCountValueEl   = document.getElementById("fairyCountValue");
    const fairyEndEl          = document.getElementById("fairyEnd");

    const btnNewFairy         = document.getElementById("btnNewFairy");
    const storyBoxEl          = document.getElementById("storyBox");
    const storyTextEl         = document.getElementById("storyText");
    const storyStepEl         = document.getElementById("storyStepIndicator");
    const storyTargetLabelEl  = document.getElementById("storyTargetLabel");
    const btnNextSentence     = document.getElementById("btnNextSentence");
    const targetBigEl         = document.getElementById("targetBig");
    const targetMotivEl       = document.getElementById("targetMotiv");
    const targetColorEl       = document.getElementById("targetColor");

    const btnSelfHit          = document.getElementById("btnSelfHit");
    const btnForeignHit       = document.getElementById("btnForeignHit");
    const btnLaidHit          = document.getElementById("btnLaidHit");
    const btnReset            = document.getElementById("btnReset");

    // --- Hilfsfunktionen ------------------------------------------------
    function rand(list) {
      return list[Math.floor(Math.random() * list.length)];
    }

    function updateScoreDisplay() {
      scoreValueEl.textContent = score;
    }

    function updateFairyCountDisplay() {
      fairyCountValueEl.textContent = fairyCount;
      if (fairyCount >= maxFairies) {
        fairyEndReached = true;
        fairyEndEl.style.display = "block";
        btnNewFairy.disabled = true;
      } else {
        fairyEndReached = false;
        fairyEndEl.style.display = "none";
        btnNewFairy.disabled = false;
      }
    }

    function resetGame() {
      score = 0;
      fairyCount = 0;
      fairyEndReached = false;
      currentStory = null;
      currentSentenceIndex = 0;
      gameStoryLocked = false;

      updateScoreDisplay();
      updateFairyCountDisplay();
      storyBoxEl.style.display = "none";
      storyTargetLabelEl.textContent = "";
      targetBigEl.style.display = "none";
      targetMotivEl.textContent = "";
      targetColorEl.textContent = "";
      fairyEndEl.style.display = "none";
      btnNewFairy.disabled = false;
    }

    // erzeugt eine neue Fairy-Geschichte
    function createFairyStory() {
      const motiv = rand(MOTIVE);
      const colorObj = rand(COLORS);
      const place = rand(PLACES);
      const mood = rand(MOODS);
      const magicEvent = rand(MAGIC_EVENTS);
      const helper = rand(HELPERS);
      const feeling = rand(FEELINGS);

      // 4–5 Sätze, Farbe erst im letzten Satz!
      const sentences = [];

      sentences.push(
        `Irgendwo ${place} wartete ein kleiner ${motiv} ganz ohne Farbe auf sein erstes Abenteuer.`
      );

      sentences.push(
        `An diesem Abend war die Luft besonders still, und der ${motiv} fühlte sich zum ersten Mal ${feeling}.`
      );

      sentences.push(
        `Plötzlich tauchte ${helper} auf, sah den ${motiv} an und flüsterte: „Du bist viel zu ${mood}, um für immer grau zu bleiben.“`
      );

      sentences.push(
        `Aus dem Nichts erschien ${magicEvent} und legte sich leise auf den ${motiv}.`
      );

      // letzter Satz: Farbe als allerletztes Wort
      sentences.push(
        `Als der Zauber sich setzte, strahlte der ${motiv} in der Farbe ${colorObj.name}.`
      );

      return {
        motiv,
        color: colorObj,
        sentences,
      };
    }

    function showStorySentence(index) {
      if (!currentStory) return;
      const total = currentStory.sentences.length;
      currentSentenceIndex = index;

      storyTextEl.textContent = currentStory.sentences[index];
      storyStepEl.textContent = `Satz ${index + 1} von ${total}`;

      if (index === total - 1) {
        btnNextSentence.textContent = "Fertig";
      } else {
        btnNextSentence.textContent = "Weiter";
      }
    }

    function finishStoryReveal() {
      if (!currentStory) return;
      // Farbiges Ziel anzeigen
      targetBigEl.style.display = "block";
      targetMotivEl.textContent = currentStory.motiv;
      targetColorEl.textContent = currentStory.color.name;
      targetColorEl.style.color = currentStory.color.css;

      // Label oben aktualisieren
      storyTargetLabelEl.textContent =
        `Ziel: ${currentStory.motiv} in ${currentStory.color.name}`;

      // Nach vollständigem Vorlesen darf wieder gekippt & gepunktet werden.
      gameStoryLocked = false;
    }

    // --- Event-Handler --------------------------------------------------
    btnNewFairy.addEventListener("click", () => {
      if (fairyEndReached) return;
      if (gameStoryLocked) return; // Sicherheit: erst Fairy fertig lesen

      currentStory = createFairyStory();
      currentSentenceIndex = 0;
      gameStoryLocked = true;

      fairyCount += 1;
      updateFairyCountDisplay();

      storyBoxEl.style.display = "flex";
      targetBigEl.style.display = "none";
      storyTargetLabelEl.textContent = "Fairy wird vorgelesen …";

      showStorySentence(0);
    });

    btnNextSentence.addEventListener("click", () => {
      if (!currentStory) return;
      const total = currentStory.sentences.length;

      if (currentSentenceIndex < total - 1) {
        showStorySentence(currentSentenceIndex + 1);
      } else {
        // letzte Zeile war sichtbar -> Fairy vollständig
        finishStoryReveal();
      }
    });

    function addPoints(amount) {
      score += amount;
      updateScoreDisplay();
    }

    btnSelfHit.addEventListener("click", () => {
      addPoints(3);
    });

    btnForeignHit.addEventListener("click", () => {
      addPoints(2);
    });

    btnLaidHit.addEventListener("click", () => {
      addPoints(1);
    });

    btnReset.addEventListener("click", () => {
      if (confirm("Neues Spiel starten? Punkte & erzählte Fairies werden auf 0 gesetzt.")) {
        resetGame();
      }
    });

    // --- Initial --------------------------------------------------------
    resetGame();
  </script>
</body>
</html>
