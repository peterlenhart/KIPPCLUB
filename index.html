<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FAIRY KIPP</title>

<style>
    body {
        background: #0e0e0e;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 0;
    }

    h1 {
        font-size: 32px;
        margin-top: 20px;
        color: #f7b42c;
    }

    .container {
        margin: 20px;
        padding: 20px;
        border-radius: 14px;
        background: #1a1a1a;
        box-shadow: 0px 0px 12px rgba(0,0,0,0.5);
    }

    #fairyText {
        min-height: 140px;
        padding: 20px;
        font-size: 20px; /* größere Schrift */
        line-height: 1.4;
        text-align: left;
        border-radius: 8px;
        background: #111;
        border: 1px solid #333;
        color: #fff;
    }

    .mainButton {
        background: #f7b42c;
        padding: 18px 40px;
        font-size: 26px;
        color: black;
        border: none;
        border-radius: 12px;
        margin-top: 25px;
        font-weight: bold;
        cursor: pointer;
    }

    /* ➜ Dein neuer WEITER-Button */
    .nextButton {
        background: rgb(164,27,133); /* DEIN VIOLETT */
        color: white;
        padding: 16px 38px;
        font-size: 24px;
        border: none;
        border-radius: 10px;
        font-weight: bold;
        margin-top: 25px;
        cursor: pointer;
    }

    .pointsBox {
        margin-top: 40px;
        font-size: 26px;
        color: #ff33cc;
    }
</style>
</head>

<body>

<h1>Fairy KIPP</h1>
<div class="container">
    <button class="mainButton" id="generateFairy">FAIRY</button>

    <div id="fairyText">Tippe auf FAIRY, um zu starten.</div>

    <button class="nextButton" id="nextPart" style="display:none;">WEITER</button>

    <div class="pointsBox">
        Fairy-Punkte: <span id="points">0</span>
    </div>
</div>

<script>
//
// ------------- FAIRY-SYSTEM – GPT-5-Mini über dein geheimes Backend -------------
// ------------- Du musst NICHTS mehr eingeben, keine API-Keys -------------------
//

let fairyParts = [];
let partIndex = 0;
let points = 0;

async function loadFairy() {

    document.getElementById("fairyText").innerHTML = "Die Fairy erscheint... bitte warten.";

    try {
        const response = await fetch("https://terlenhart-fairy-proxy.vercel.app/fairy");  
        const data = await response.json();

        //
        // GPT-Antwort in 1–2-Satz-Blöcke zerlegen:
        //
        let text = data.fairy.replace(/\n+/g, " ").trim();

        fairyParts = text.match(/[^.!?]+[.!?]/g) || [text];

        // Begrenzen auf 1–2 Sätze pro Abschnitt:
        fairyParts = fairyParts.map((part) => part.trim()).filter((p) => p.length > 0);

        // Start beim ersten Abschnitt:
        partIndex = 0;
        showPart();

    } catch (e) {
        document.getElementById("fairyText").innerHTML =
            "Die Fairy hat sich im Nebel verirrt. Bitte Internet prüfen.";
    }
}

function showPart() {
    document.getElementById("fairyText").innerHTML = fairyParts[partIndex];

    // Weiter-Button nur anzeigen, wenn weiterer Abschnitt existiert:
    document.getElementById("nextPart").style.display =
        partIndex < fairyParts.length - 1 ? "inline-block" : "none";

    // Punkte erhöhen, wenn letzter Abschnitt erreicht wird:
    if (partIndex === fairyParts.length - 1) {
        points++;
        document.getElementById("points").innerText = points;
    }
}

document.getElementById("generateFairy").addEventListener("click", loadFairy);

document.getElementById("nextPart").addEventListener("click", () => {
    if (partIndex < fairyParts.length - 1) {
        partIndex++;
        showPart();
    }
});
</script>

</body>
</html>
