<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Fairy KIPP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Verspielte Schrift für "Fairy" -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

  <style>
    :root {
      /* Deine Farben */
      --color-blue: rgb(0, 101, 171);
      --color-violet: rgb(170, 0, 120);
      --color-green: rgb(59, 165, 43);
      --color-orange: rgb(242, 150, 0);
      --color-dark: #202020;
      --color-darker: #141414;
      --color-text: #f5f5f5;
      --color-muted: #b0b0b0;
      --radius-card: 22px;
      --radius-btn: 7px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #303030 0, #050505 55%);
      color: var(--color-text);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 18px 10px 32px;
    }

    .app-shell {
      width: 100%;
      max-width: 460px;
      background: var(--color-darker);
      border-radius: var(--radius-card);
      padding: 18px 18px 22px;
      box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.7),
        0 0 0 1px rgba(255, 255, 255, 0.04);
    }

    /* Farbstreifen wie am Boxrand */
    .color-strip {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 4px;
      margin-bottom: 14px;
    }

    .color-block {
      height: 10px;
    }
    .color-orange { background: var(--color-orange); }
    .color-blue   { background: var(--color-blue); }
    .color-violet { background: var(--color-violet); }
    .color-green  { background: var(--color-green); }

    .title {
      text-align: center;
      margin-bottom: 4px;
    }

    .title-fairy {
      font-family: "Pacifico", system-ui, sans-serif;
      font-size: 1.7rem;
      letter-spacing: 0.03em;
      color: var(--color-orange);
      text-shadow: 0 0 10px rgba(242, 150, 0, 0.8);
    }

    .title-kipp {
      font-weight: 800;
      font-size: 1.6rem;
      letter-spacing: 0.16em;
      margin-left: 4px;
      color: var(--color-blue);
      text-transform: uppercase;
    }

    .subtitle {
      text-align: center;
      font-size: 0.72rem;
      letter-spacing: 0.28em;
      text-transform: uppercase;
      color: var(--color-muted);
      margin-bottom: 18px;
    }

    .fairy-button {
      width: 100%;
      padding: 16px 10px;
      background: var(--color-orange);
      color: #1a1204;
      border: none;
      border-radius: var(--radius-btn);
      font-weight: 800;
      font-size: 1.2rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      cursor: pointer;
      box-shadow:
        0 0 0 2px rgba(0, 0, 0, 0.3),
        0 10px 28px rgba(242, 150, 0, 0.55);
      margin-bottom: 18px;
      transition: transform 0.1s ease, box-shadow 0.1s ease,
                  filter 0.1s ease;
    }

    .fairy-button:active {
      transform: translateY(1px);
      box-shadow:
        0 4px 16px rgba(242, 150, 0, 0.45);
      filter: brightness(0.96);
    }

    .panel {
      background: #181818;
      border-radius: var(--radius-btn);
      padding: 14px 12px 12px;
      margin-bottom: 14px;
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.03);
    }

    .story-box {
      background: #101010;
      border-radius: var(--radius-btn);
      padding: 12px 11px 14px;
      border: 1px solid rgba(255, 255, 255, 0.055);
      min-height: 92px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .story-text {
      font-size: 0.92rem;
      line-height: 1.45;
      color: #f4f4f4;
      text-align: left;
      white-space: pre-wrap;
    }

    .section-info {
      margin-top: 8px;
      text-align: right;
      font-size: 0.72rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--color-muted);
    }

    .controls-row {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
    }

    .btn-next {
      min-width: 110px;
      padding: 9px 14px;
      background: transparent;
      border-radius: var(--radius-btn);
      border: 1px solid var(--color-violet);
      color: var(--color-violet);
      font-size: 0.82rem;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      cursor: pointer;
      transition: background 0.1s ease, color 0.1s ease;
    }

    .btn-next:disabled {
      opacity: 0.25;
      cursor: default;
    }

    .btn-next:not(:disabled):hover {
      background: var(--color-violet);
      color: #ffffff;
    }

    .fund-row {
      margin-top: 6px;
      display: flex;
      justify-content: center;
    }

    .btn-fund {
      width: 100%;
      padding: 13px 12px;
      background: var(--color-blue);
      border-radius: var(--radius-btn);
      border: none;
      color: #f4f8ff;
      font-weight: 700;
      font-size: 0.96rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      cursor: pointer;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.5),
                  0 8px 22px rgba(0, 101, 171, 0.55);
      transition: transform 0.1s ease, box-shadow 0.1s ease,
                  filter 0.1s ease;
    }

    .btn-fund:active {
      transform: translateY(1px);
      box-shadow: 0 4px 14px rgba(0, 101, 171, 0.5);
      filter: brightness(0.97);
    }

    .score-panel {
      margin-top: 10px;
      background: #111111;
      border-radius: var(--radius-btn);
      padding: 12px 10px 16px;
      text-align: center;
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.03);
    }

    .score-label {
      font-size: 0.78rem;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--color-muted);
      margin-bottom: 6px;
    }

    .score-value {
      font-size: 2.6rem;
      font-weight: 800;
      line-height: 1.1;
    }

    .fairies-count {
      margin-top: 6px;
      font-size: 0.8rem;
      color: var(--color-muted);
    }

    /* End-Screen */
    .end-screen {
      display: none;
      text-align: center;
      padding-top: 24px;
      padding-bottom: 10px;
    }

    .end-title {
      font-family: "Pacifico", system-ui, sans-serif;
      font-size: 2.1rem;
      color: var(--color-violet);
      text-shadow: 0 0 14px rgba(170, 0, 120, 0.9);
      margin-bottom: 8px;
    }

    .end-score-label {
      font-size: 0.85rem;
      letter-spacing: 0.24em;
      text-transform: uppercase;
      color: var(--color-muted);
      margin-bottom: 6px;
    }

    .end-score-value {
      font-size: 3.1rem;
      font-weight: 800;
      margin-bottom: 16px;
    }

    .btn-restart {
      padding: 11px 16px;
      background: var(--color-green);
      border-radius: var(--radius-btn);
      border: none;
      color: #031003;
      font-weight: 700;
      font-size: 0.9rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(59, 165, 43, 0.45);
      transition: transform 0.1s ease, box-shadow 0.1s ease,
                  filter 0.1s ease;
    }

    .btn-restart:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(59, 165, 43, 0.4);
      filter: brightness(0.96);
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 380px) {
      .subtitle {
        letter-spacing: 0.18em;
      }
      .fairy-button {
        font-size: 1.05rem;
      }
      .score-value {
        font-size: 2.3rem;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell" id="appMain">
    <div class="color-strip">
      <div class="color-block color-orange"></div>
      <div class="color-block color-blue"></div>
      <div class="color-block color-violet"></div>
      <div class="color-block color-green"></div>
    </div>

    <header class="title">
      <span class="title-fairy">Fairy</span>
      <span class="title-kipp">KIPP</span>
    </header>
    <div class="subtitle">Unendlich viele Kipp-Geschichten</div>

    <button id="fairyButton" class="fairy-button">FAIRY</button>

    <section class="panel" id="storyPanel">
      <div class="story-box">
        <div id="storyText" class="story-text">
          Tippe auf FAIRY, um eine erste Fairy zu hören.
        </div>
      </div>
      <div class="section-info" id="sectionInfo"></div>
      <div class="controls-row">
        <button id="nextButton" class="btn-next" disabled>WEITER</button>
      </div>
      <div class="fund-row">
        <button id="fundButton" class="btn-fund">FAIRY-FUND</button>
      </div>
    </section>

    <section class="score-panel">
      <div class="score-label">Fairy-Punkte</div>
      <div id="scoreValue" class="score-value">0</div>
      <div class="fairies-count">
        Erzählte Fairies: <span id="fairiesCount">0</span> / 6
      </div>
    </section>

    <!-- End-Screen -->
    <section class="end-screen" id="endScreen">
      <div class="end-title">Fairy-End</div>
      <div class="end-score-label">Gesamtpunkte</div>
      <div id="endScoreValue" class="end-score-value">0</div>
      <button id="restartButton" class="btn-restart">Neues Spiel</button>
    </section>
  </div>

  <script>
    // ----------- Daten für Fairies --------------

    const motifs = [
      {
        name: "Wasserball",
        articleAcc: "den",
        hints: [
          "Zwischen feinem Sand und leisen Wellen schien etwas Rundes immer wieder kurz aus dem Schatten zu rollen.",
          "Fernes Lachen hallte über den Platz, als ob irgendwo ein verstecktes Spiel längst noch nicht vorbei wäre."
        ]
      },
      {
        name: "Auto",
        articleAcc: "das",
        hints: [
          "In der Ferne glitt ein schwacher Schein wie eine kleine Spur über den Boden, begleitet von einem fast unhörbaren Summen.",
          "Zwischen zwei alten Mauern zeichnete sich eine schmale Spur ab, als hätte sich hier etwas mit leisen Rädern vorbeigeschoben."
        ]
      },
      {
        name: "Farbfleck",
        articleAcc: "den",
        hints: [
          "Auf dem Boden wirkten manche Stellen, als hätte jemand heimlich mit der Nacht gemalt.",
          "Zwischen den Schatten schimmerte ein seltsamer Tupfer, der nicht ganz zur Umgebung passen wollte."
        ]
      },
      {
        name: "Buch",
        articleAcc: "das",
        hints: [
          "Die Luft roch nach Staub und Geschichten, als würden unsichtbare Seiten leise umgeblättert.",
          "Aus einer dunklen Ecke kam ein Hauch von alten Wörtern, obwohl niemand zu lesen schien."
        ]
      },
      {
        name: "Gießkanne",
        articleAcc: "die",
        hints: [
          "Irgendwo tropfte es regelmäßig, als würde jemand heimlich die Pflanzen flüstern hören.",
          "Zwischen den Pflanzen glänzte etwas mit einem schmalen Griff und einer langen Öffnung, bereit, jeden Tropfen zu lenken."
        ]
      },
      {
        name: "Kerze",
        articleAcc: "die",
        hints: [
          "Ein warmer, ruhiger Duft lag in der Luft, als hätte jemand ein kleines Licht gut versteckt.",
          "An einer ruhigen Stelle flackerte ein winziger Schein, kaum größer als ein Atemzug."
        ]
      },
      {
        name: "Blume",
        articleAcc: "die",
        hints: [
          "Mitten im Grau zeigte sich ein zarter Duft, der nicht von Stein oder Holz stammen konnte.",
          "Zwischen den Ritzen des Bodens reckte sich etwas Feines zum Licht, als hätte es den Platz heimlich erobert."
        ]
      },
      {
        name: "Fisch",
        articleAcc: "den",
        hints: [
          "Im Wasser zeichnete sich eine kleine Bewegung ab, als würde ein Schatten hin und her huschen.",
          "Die Oberfläche kräuselte sich kurz, als hätte darunter jemand neugierig nach oben geschaut."
        ]
      },
      {
        name: "Schmetterling",
        articleAcc: "den",
        hints: [
          "Ein kaum spürbarer Luftzug strich vorbei, als würde etwas Leichtes daran hängen.",
          "Zwischen den Schatten tanzte ein winziger Schimmer, mal hier, mal dort, ohne einen Laut zu machen."
        ]
      },
      {
        name: "Schuh",
        articleAcc: "den",
        hints: [
          "Im Staub zeichnete sich eine kleine Spur ab, als wäre jemand mitten im Schritt stehen geblieben.",
          "Zwischen all den Dingen wirkte es, als hätte etwas auf den richtigen Weg gewartet."
        ]
      },
      {
        name: "Tasse",
        articleAcc: "die",
        hints: [
          "Ein feiner Duft von Wärme und Ruhe schien aus einer unscheinbaren Ecke zu kommen.",
          "Auf einem kleinen Vorsprung stand etwas, das jeden Moment zum Anheben einlud."
        ]
      },
      {
        name: "T-Shirt",
        articleAcc: "das",
        hints: [
          "Am Rand des Weges hing etwas Stoffiges, das sich ganz leicht im Luftzug bewegte.",
          "Auf einer Kante lag etwas Weiches zusammengefaltet, als würde es auf einen neuen Besitzer warten."
        ]
      }
    ];

    const colors = ["Blau", "Violett", "Orange", "Grün"];

    const colorAdjectives = [
      "leuchtendem",
      "sanftem",
      "kräftigem",
      "schimmerndem",
      "tiefem"
    ];

    const openers = [
      "Der Abend legte sich wie ein flüsternder Schleier über den Weg, als ob irgendwo etwas auf einen Moment der Aufmerksamkeit wartete.",
      "Ein leiser Wind strich durch die Luft und ließ die Schatten tanzen, als hielten sie den Atem an.",
      "In der stillen Dämmerung schien die Welt für einen Augenblick langsamer zu atmen.",
      "Die Umgebung war so ruhig, dass jedes kleine Geräusch wie ein Geheimnis klang.",
      "Zwischen Licht und Dunkel fühlte sich der Ort an, als könnte hier jederzeit etwas Unerwartetes auftauchen."
    ];

    // ----------- Zustand -------------

    const fairyButton = document.getElementById("fairyButton");
    const nextButton = document.getElementById("nextButton");
    const fundButton = document.getElementById("fundButton");
    const storyTextEl = document.getElementById("storyText");
    const sectionInfoEl = document.getElementById("sectionInfo");
    const scoreValueEl = document.getElementById("scoreValue");
    const fairiesCountEl = document.getElementById("fairiesCount");

    const endScreen = document.getElementById("endScreen");
    const endScoreValueEl = document.getElementById("endScoreValue");
    const restartButton = document.getElementById("restartButton");
    const storyPanel = document.getElementById("storyPanel");

    let currentStoryParts = [];
    let currentSectionIndex = 0;
    let lastStoryId = null;
    let score = 0;
    let toldFairies = 0;
    const maxFairies = 6;
    let lastFairyStartedHere = false;
    let gameEnded = false;

    function randInt(max) {
      return Math.floor(Math.random() * max);
    }

    function generateStory() {
      let attempts = 0;
      let motifIndex, colorIndex, adjIndex, storyId;

      do {
        motifIndex = randInt(motifs.length);
        colorIndex = randInt(colors.length);
        adjIndex = randInt(colorAdjectives.length);
        storyId = motifIndex + "-" + colorIndex + "-" + adjIndex;
        attempts++;
      } while (storyId === lastStoryId && attempts < 10);

      lastStoryId = storyId;

      const motif = motifs[motifIndex];
      const color = colors[colorIndex];
      const adj = colorAdjectives[adjIndex];

      const opener = openers[randInt(openers.length)];
      const hint = motif.hints[randInt(motif.hints.length)];
      const reveal =
        "Am Ende entdeckte jemand " +
        motif.articleAcc +
        " " +
        motif.name +
        " in " +
        adj +
        " " +
        color +
        ".";

      return [opener, hint, reveal];
    }

    function showCurrentSection() {
      if (!currentStoryParts.length) return;
      storyTextEl.textContent = currentStoryParts[currentSectionIndex];

      sectionInfoEl.textContent =
        "Abschnitt " +
        (currentSectionIndex + 1) +
        " von " +
        currentStoryParts.length;

      if (currentSectionIndex >= currentStoryParts.length - 1) {
        nextButton.disabled = true;
      } else {
        nextButton.disabled = false;
      }
    }

    function startNewFairy() {
      if (gameEnded) return;

      currentStoryParts = generateStory();
      currentSectionIndex = 0;
      showCurrentSection();

      // Neue Fairy wurde von DIESEM Handy gestartet
      lastFairyStartedHere = true;

      toldFairies++;
      if (toldFairies > maxFairies) toldFairies = maxFairies;
      fairiesCountEl.textContent = toldFairies + " / " + maxFairies;

      if (toldFairies === maxFairies) {
        // Nur markieren – beendet wird erst, wenn der Spieler möchte,
        // hier aber schon vorbereitet.
      }
    }

    function addFundPoints() {
      if (gameEnded) return;

      if (!currentStoryParts.length) return;

      // Wenn dieses Handy die aktuelle Fairy gestartet hat → 3 Punkte,
      // sonst 2 Punkte (fremde Fairy).
      const gained = lastFairyStartedHere ? 3 : 2;
      score += gained;
      scoreValueEl.textContent = score;

      // Nach dem Bepunkten gehört die Fairy als "abgehandelt"
      lastFairyStartedHere = false;

      // Wenn maximale Anzahl erzählter Fairies erreicht UND der Spieler
      // jetzt gewertet hat, kann das Spiel auf Wunsch beendet werden.
      if (toldFairies >= maxFairies) {
        showEndScreen();
      }
    }

    function showEndScreen() {
      gameEnded = true;
      storyPanel.classList.add("hidden");
      fairyButton.classList.add("hidden");
      endScoreValueEl.textContent = score;
      endScreen.style.display = "block";
    }

    function resetGame() {
      gameEnded = false;
      score = 0;
      toldFairies = 0;
      currentStoryParts = [];
      currentSectionIndex = 0;
      lastStoryId = null;
      lastFairyStartedHere = false;

      scoreValueEl.textContent = "0";
      fairiesCountEl.textContent = "0 / " + maxFairies;
      storyTextEl.textContent =
        "Tippe auf FAIRY, um eine erste Fairy zu hören.";
      sectionInfoEl.textContent = "";
      nextButton.disabled = true;

      endScreen.style.display = "none";
      storyPanel.classList.remove("hidden");
      fairyButton.classList.remove("hidden");
    }

    // ----------- Events -------------

    fairyButton.addEventListener("click", startNewFairy);

    nextButton.addEventListener("click", () => {
      if (!currentStoryParts.length) return;
      if (currentSectionIndex < currentStoryParts.length - 1) {
        currentSectionIndex++;
        showCurrentSection();
      }
    });

    fundButton.addEventListener("click", addFundPoints);
    restartButton.addEventListener("click", resetGame);
  </script>
</body>
</html>
